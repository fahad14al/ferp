{% extends 'base.html' %}
{% load static %}

{% block title %}Sales vs Purchase Analysis{% endblock %}

{% block extra_css %}
<style>
    .comparison-card {
        border-radius: 10px;
        transition: all 0.3s;
    }
    .comparison-card:hover {
        transform: scale(1.02);
        box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }
    .profit-positive { color: #1cc88a; }
    .profit-negative { color: #e74a3b; }
    .chart-container {
        position: relative;
        height: 350px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="h3 mb-2">{{ report_title }}</h1>
            <p class="text-muted">Period: {{ start_date }} to {{ end_date }}</p>
        </div>
    </div>

    <!-- Comparison Cards -->
    <div class="row mb-4">
        <div class="col-lg-4 mb-4">
            <div class="card comparison-card shadow border-left-primary h-100">
                <div class="card-body">
                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-2">Total Sales</div>
                    <div class="h4 mb-2 font-weight-bold">{{ total_sales|floatformat:2 }}</div>
                    <div class="text-muted small">{{ sales_count }} orders</div>
                </div>
            </div>
        </div>
        <div class="col-lg-4 mb-4">
            <div class="card comparison-card shadow border-left-warning h-100">
                <div class="card-body">
                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-2">Total Purchases</div>
                    <div class="h4 mb-2 font-weight-bold">{{ total_purchases|floatformat:2 }}</div>
                    <div class="text-muted small">{{ purchase_count }} orders</div>
                </div>
            </div>
        </div>
        <div class="col-lg-4 mb-4">
            <div class="card comparison-card shadow border-left-success h-100">
                <div class="card-body">
                    <div class="text-xs font-weight-bold text-success text-uppercase mb-2">Gross Margin</div>
                    <div class="h4 mb-2 font-weight-bold {% if gross_margin >= 0 %}profit-positive{% else %}profit-negative{% endif %}">
                        {{ gross_margin|floatformat:2 }}
                    </div>
                    <div class="text-muted small">{{ gross_margin_percentage|floatformat:1 }}% margin</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Comparison -->
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-primary text-white">
                    <h6 class="m-0 font-weight-bold">Sales Overview</h6>
                </div>
                <div class="card-body">
                    <table class="table table-borderless">
                        <tr>
                            <td><strong>Total Revenue:</strong></td>
                            <td class="text-end">{{ total_sales|floatformat:2 }}</td>
                        </tr>
                        <tr>
                            <td><strong>Number of Orders:</strong></td>
                            <td class="text-end">{{ sales_count }}</td>
                        </tr>
                        <tr>
                            <td><strong>Average Order Value:</strong></td>
                            <td class="text-end">
                                {% if sales_count > 0 %}
                                    {{ total_sales|floatformat:2 }}
                                {% else %}
                                    0.00
                                {% endif %}
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-warning text-white">
                    <h6 class="m-0 font-weight-bold">Purchase Overview</h6>
                </div>
                <div class="card-body">
                    <table class="table table-borderless">
                        <tr>
                            <td><strong>Total Cost:</strong></td>
                            <td class="text-end">{{ total_purchases|floatformat:2 }}</td>
                        </tr>
                        <tr>
                            <td><strong>Number of Orders:</strong></td>
                            <td class="text-end">{{ purchase_count }}</td>
                        </tr>
                        <tr>
                            <td><strong>Average Order Value:</strong></td>
                            <td class="text-end">
                                {% if purchase_count > 0 %}
                                    {{ total_purchases|floatformat:2 }}
                                {% else %}
                                    0.00
                                {% endif %}
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Profitability Analysis -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header py-3 bg-success text-white">
                    <h6 class="m-0 font-weight-bold">Profitability Analysis</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Financial Summary</h5>
                            <table class="table">
                                <tr>
                                    <td><strong>Revenue (Sales):</strong></td>
                                    <td class="text-end text-success">{{ total_sales|floatformat:2 }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Cost (Purchases):</strong></td>
                                    <td class="text-end text-danger">{{ total_purchases|floatformat:2 }}</td>
                                </tr>
                                <tr class="table-active">
                                    <td><strong>Gross Profit:</strong></td>
                                    <td class="text-end {% if gross_margin >= 0 %}profit-positive{% else %}profit-negative{% endif %}">
                                        <strong>{{ gross_margin|floatformat:2 }}</strong>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>Profit Margin:</strong></td>
                                    <td class="text-end">
                                        <strong>{{ gross_margin_percentage|floatformat:2 }}%</strong>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h5>Performance Indicators</h5>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>Profit Margin</span>
                                    <span>{{ gross_margin_percentage|floatformat:1 }}%</span>
                                </div>
                                <div class="progress" style="height: 25px;">
                                    <div class="progress-bar {% if gross_margin_percentage >= 30 %}bg-success{% elif gross_margin_percentage >= 15 %}bg-warning{% else %}bg-danger{% endif %}" 
                                         role="progressbar" 
                                         style="width: {{ gross_margin_percentage }}%"
                                         aria-valuenow="{{ gross_margin_percentage }}" 
                                         aria-valuemin="0" 
                                         aria-valuemax="100">
                                    </div>
                                </div>
                            </div>
                            <div class="alert {% if gross_margin_percentage >= 30 %}alert-success{% elif gross_margin_percentage >= 15 %}alert-warning{% else %}alert-danger{% endif %}">
                                <strong>Status:</strong>
                                {% if gross_margin_percentage >= 30 %}
                                    <i class="fas fa-check-circle"></i> Excellent profitability
                                {% elif gross_margin_percentage >= 15 %}
                                    <i class="fas fa-exclamation-triangle"></i> Moderate profitability
                                {% else %}
                                    <i class="fas fa-times-circle"></i> Low profitability - review pricing
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
